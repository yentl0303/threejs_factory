{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport * as THREE from 'three';\nimport camera from '../camera';\nexport default class ALarm {\n  constructor(name = '治安', position = {\n    x: 0,\n    z: 0\n  }) {\n    const typeName = {\n      火警: \"./texture/alarm/fire.png\",\n      治安: \"./texture/alarm/jingcha.png\",\n      电力: \"./texture/alarm/e.png\"\n    };\n    const textureLoad = new THREE.TextureLoader();\n    const texture = textureLoad.load(typeName[name]);\n    this.material = new THREE.SpriteMaterial({\n      map: texture\n    });\n    this.mesh = new THREE.Sprite(this.material);\n    this.mesh.position.set(position.x, 1, position.z);\n    this.mesh.scale.set(0.3, 0.3, 0.3);\n\n    // 封装点击事件\n    this.fns = [];\n\n    // 只有射线射到警告这里，点击事件才能执行, 设置物体碰撞\n    this.raycaster = new THREE.Raycaster();\n    this.mouse = new THREE.Vector2();\n\n    // 事件监听\n    window.addEventListener('click', event => {\n      // -1到1\n      this.mouse.x = event.clientX / window.innerWidth * 2 - 1;\n      this.mouse.y = -(event.clientY / window.innerHeight * 2 - 1);\n\n      // 设置相机\n      this.raycaster.setFromCamera(this.mouse, camera);\n      event.mesh = this.mesh;\n      // 射线有没有碰撞到警告图标\n      const intersects = this.raycaster.intersectObject(this.mesh);\n      if (intersects.length > 0) {\n        this.fns.forEach(item => {\n          item(event);\n        });\n      }\n    });\n  }\n  onClick(fn) {\n    this.fns.push(fn);\n  }\n  onDestroy() {\n    this.mesh.remove();\n    this.mesh.parent.remove();\n    this.mesh.material.dispose();\n    this.mesh.geometry.dispose();\n  }\n}","map":{"version":3,"names":["THREE","camera","ALarm","constructor","name","position","x","z","typeName","火警","治安","电力","textureLoad","TextureLoader","texture","load","material","SpriteMaterial","map","mesh","Sprite","set","scale","fns","raycaster","Raycaster","mouse","Vector2","window","addEventListener","event","clientX","innerWidth","y","clientY","innerHeight","setFromCamera","intersects","intersectObject","length","forEach","item","onClick","fn","push","onDestroy","remove","parent","dispose","geometry"],"sources":["D:/vscodeDemo/threeDemo/threejs_smartcity/src/threeModal/mesh/alarm.js"],"sourcesContent":["import * as THREE from 'three'\r\nimport camera from '../camera'\r\nexport default class ALarm {\r\n  constructor (name = '治安', position = {x: 0, z: 0}) {\r\n    const typeName = {\r\n      火警: \"./texture/alarm/fire.png\",\r\n      治安: \"./texture/alarm/jingcha.png\",\r\n      电力: \"./texture/alarm/e.png\",\r\n    }\r\n    const textureLoad = new THREE.TextureLoader()\r\n    const texture =  textureLoad.load(typeName[name])\r\n    this.material = new THREE.SpriteMaterial({ map: texture })\r\n\r\n    this.mesh = new THREE.Sprite(this.material)\r\n\r\n    this.mesh.position.set(position.x, 1, position.z)\r\n    this.mesh.scale.set(0.3, 0.3, 0.3)\r\n\r\n    // 封装点击事件\r\n    this.fns = []\r\n\r\n    // 只有射线射到警告这里，点击事件才能执行, 设置物体碰撞\r\n    this.raycaster = new THREE.Raycaster()\r\n    this.mouse = new THREE.Vector2()\r\n\r\n    // 事件监听\r\n    window.addEventListener('click', event => {\r\n      // -1到1\r\n      this.mouse.x = (event.clientX / window.innerWidth) * 2 -1\r\n      this.mouse.y = - ((event.clientY / window.innerHeight) * 2 -1)\r\n\r\n      // 设置相机\r\n      this.raycaster.setFromCamera(this.mouse, camera)\r\n      event.mesh = this.mesh\r\n      // 射线有没有碰撞到警告图标\r\n      const intersects = this.raycaster.intersectObject(this.mesh)\r\n      if (intersects.length > 0) {\r\n        this.fns.forEach(item => {\r\n          item(event);\r\n        })\r\n      }\r\n    })\r\n  }\r\n  onClick(fn) {\r\n    this.fns.push(fn)\r\n  }\r\n  onDestroy() {\r\n    this.mesh.remove()\r\n    this.mesh.parent.remove()\r\n    this.mesh.material.dispose()\r\n    this.mesh.geometry.dispose()\r\n  }\r\n}\r\n"],"mappings":";AAAA,OAAO,KAAKA,KAAK,MAAM,OAAO;AAC9B,OAAOC,MAAM,MAAM,WAAW;AAC9B,eAAe,MAAMC,KAAK,CAAC;EACzBC,WAAW,CAAEC,IAAI,GAAG,IAAI,EAAEC,QAAQ,GAAG;IAACC,CAAC,EAAE,CAAC;IAAEC,CAAC,EAAE;EAAC,CAAC,EAAE;IACjD,MAAMC,QAAQ,GAAG;MACfC,EAAE,EAAE,0BAA0B;MAC9BC,EAAE,EAAE,6BAA6B;MACjCC,EAAE,EAAE;IACN,CAAC;IACD,MAAMC,WAAW,GAAG,IAAIZ,KAAK,CAACa,aAAa,EAAE;IAC7C,MAAMC,OAAO,GAAIF,WAAW,CAACG,IAAI,CAACP,QAAQ,CAACJ,IAAI,CAAC,CAAC;IACjD,IAAI,CAACY,QAAQ,GAAG,IAAIhB,KAAK,CAACiB,cAAc,CAAC;MAAEC,GAAG,EAAEJ;IAAQ,CAAC,CAAC;IAE1D,IAAI,CAACK,IAAI,GAAG,IAAInB,KAAK,CAACoB,MAAM,CAAC,IAAI,CAACJ,QAAQ,CAAC;IAE3C,IAAI,CAACG,IAAI,CAACd,QAAQ,CAACgB,GAAG,CAAChB,QAAQ,CAACC,CAAC,EAAE,CAAC,EAAED,QAAQ,CAACE,CAAC,CAAC;IACjD,IAAI,CAACY,IAAI,CAACG,KAAK,CAACD,GAAG,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC;;IAElC;IACA,IAAI,CAACE,GAAG,GAAG,EAAE;;IAEb;IACA,IAAI,CAACC,SAAS,GAAG,IAAIxB,KAAK,CAACyB,SAAS,EAAE;IACtC,IAAI,CAACC,KAAK,GAAG,IAAI1B,KAAK,CAAC2B,OAAO,EAAE;;IAEhC;IACAC,MAAM,CAACC,gBAAgB,CAAC,OAAO,EAAEC,KAAK,IAAI;MACxC;MACA,IAAI,CAACJ,KAAK,CAACpB,CAAC,GAAIwB,KAAK,CAACC,OAAO,GAAGH,MAAM,CAACI,UAAU,GAAI,CAAC,GAAE,CAAC;MACzD,IAAI,CAACN,KAAK,CAACO,CAAC,GAAG,EAAIH,KAAK,CAACI,OAAO,GAAGN,MAAM,CAACO,WAAW,GAAI,CAAC,GAAE,CAAC,CAAC;;MAE9D;MACA,IAAI,CAACX,SAAS,CAACY,aAAa,CAAC,IAAI,CAACV,KAAK,EAAEzB,MAAM,CAAC;MAChD6B,KAAK,CAACX,IAAI,GAAG,IAAI,CAACA,IAAI;MACtB;MACA,MAAMkB,UAAU,GAAG,IAAI,CAACb,SAAS,CAACc,eAAe,CAAC,IAAI,CAACnB,IAAI,CAAC;MAC5D,IAAIkB,UAAU,CAACE,MAAM,GAAG,CAAC,EAAE;QACzB,IAAI,CAAChB,GAAG,CAACiB,OAAO,CAACC,IAAI,IAAI;UACvBA,IAAI,CAACX,KAAK,CAAC;QACb,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;EACJ;EACAY,OAAO,CAACC,EAAE,EAAE;IACV,IAAI,CAACpB,GAAG,CAACqB,IAAI,CAACD,EAAE,CAAC;EACnB;EACAE,SAAS,GAAG;IACV,IAAI,CAAC1B,IAAI,CAAC2B,MAAM,EAAE;IAClB,IAAI,CAAC3B,IAAI,CAAC4B,MAAM,CAACD,MAAM,EAAE;IACzB,IAAI,CAAC3B,IAAI,CAACH,QAAQ,CAACgC,OAAO,EAAE;IAC5B,IAAI,CAAC7B,IAAI,CAAC8B,QAAQ,CAACD,OAAO,EAAE;EAC9B;AACF"},"metadata":{},"sourceType":"module","externalDependencies":[]}