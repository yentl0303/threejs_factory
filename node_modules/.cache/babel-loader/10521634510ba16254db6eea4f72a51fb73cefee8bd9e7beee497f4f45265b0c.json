{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport scene from '@/threeModal/scene';\n// 3.1导入相机配置\nimport camera from '@/threeModal/camera';\n// 4.导入渲染器\nimport renderer from '@/threeModal/renderer';\n// // 导入控制器\nimport controls from '@/threeModal/controls';\n// 导入创建物体文件\nimport createMesh from '@/threeModal/createMesh';\n// 导入渲染更新\nimport animate from '@/threeModal/animate';\n// 导入初始化监听屏幕大小\nimport '@/threeModal/init';\nimport gsap from 'gsap';\n// 5.1导入坐标轴\nimport axse from '@/threeModal/axseHelp';\nimport { ref, onMounted, watch } from 'vue';\nimport Alarm from '@/threeModal/mesh/alarm';\nimport LineWall from '@/threeModal/mesh/lineWall';\nimport FlyLineShader from '@/threeModal/mesh/flyLineShader';\nimport LineRader from '@/threeModal/mesh/lineRader';\nimport eventBus from '@/utils/eventBus';\nexport default {\n  __name: 'SceneCanvas',\n  props: ['resCityList'],\n  setup(__props, {\n    expose\n  }) {\n    expose();\n    const props = __props;\n\n    // 1.导入threejs\n    // import * as THREE from 'three'\n    // 2.导入(初始化)场景\n\n    // 7.1获取场景div\n    let sceneDiv = ref(null);\n\n    // 3.2.将相机添加进场景\n    scene.add(camera);\n\n    // 5.2 创建坐标轴\n    scene.add(axse);\n\n    // 6.创建物体\n    createMesh();\n\n    // vue挂载成功之后再去追加dom\n    onMounted(() => {\n      // 7.2将渲染器加入dom\n      sceneDiv.value.appendChild(renderer.domElement);\n      // 8.2渲染执行\n      animate();\n    });\n    const meshDestroy = [];\n    const meshFn = {\n      火警: (position, i) => {\n        // 光墙\n        // 添加光墙\n        const lineWall = new LineWall(0.3, 2, position);\n        lineWall.meshIndex = i;\n        meshDestroy.push(lineWall);\n        scene.add(lineWall.mesh);\n      },\n      治安: (position, i) => {\n        // 光线\n        // 添加光线\n        const flyLineShader = new FlyLineShader(position);\n        flyLineShader.meshIndex = i;\n        scene.add(flyLineShader.mesh);\n        meshDestroy.push(flyLineShader);\n      },\n      电力: (position, i) => {\n        // 雷达\n        // 添加雷达\n        const lineRader = new LineRader(1, position);\n        lineRader.meshIndex = i;\n        scene.add(lineRader.mesh);\n        meshDestroy.push(lineRader);\n      }\n    };\n    eventBus.on('meitSelect', i => {\n      meshDestroy.forEach(item => {\n        if (item.meshIndex === i) {\n          item.mesh.visible = true;\n        } else {\n          item.mesh.visible = false;\n        }\n      });\n      const position = {\n        x: props.resCityList[i].position.x / 15 - 3.5,\n        y: 0,\n        z: props.resCityList[i].position.z / 15 - 3.5\n      };\n      gsap.to(controls.target, {\n        x: position.x,\n        y: position.y,\n        z: position.z,\n        duration: 1,\n        ease: 'none'\n      });\n    });\n    watch(() => props.resCityList, () => {\n      // 每次得到新的数据要销毁旧物体\n      meshDestroy.forEach(item => {\n        item.onRemove();\n      });\n      props.resCityList.forEach((item, i) => {\n        // console.log(item, i)\n        //    返回的位置数据为0-100\n        const position = {\n          x: item.position.x / 15 - 3.5,\n          z: item.position.z / 15 - 3.5\n        };\n        // 生成精灵图\n        // 添加警告标识\n        const alarm = new Alarm(item.name, position);\n        alarm.meshIndex = i;\n        alarm.onClick(() => {\n          // console.log(item.name, i);\n          eventBus.emit(\"spriteClick\", alarm);\n        });\n        // 将生成的物体放到数组，以待每次新数据传入生成新物体时销毁旧物体\n        meshDestroy.push(alarm);\n        scene.add(alarm.mesh);\n        if (meshFn[item.name]) {\n          meshFn[item.name](position, i);\n        }\n      });\n    });\n    const __returned__ = {\n      props,\n      get sceneDiv() {\n        return sceneDiv;\n      },\n      set sceneDiv(v) {\n        sceneDiv = v;\n      },\n      meshDestroy,\n      meshFn,\n      get scene() {\n        return scene;\n      },\n      get camera() {\n        return camera;\n      },\n      get renderer() {\n        return renderer;\n      },\n      get controls() {\n        return controls;\n      },\n      get createMesh() {\n        return createMesh;\n      },\n      get animate() {\n        return animate;\n      },\n      get gsap() {\n        return gsap;\n      },\n      get axse() {\n        return axse;\n      },\n      ref,\n      onMounted,\n      watch,\n      get Alarm() {\n        return Alarm;\n      },\n      get LineWall() {\n        return LineWall;\n      },\n      get FlyLineShader() {\n        return FlyLineShader;\n      },\n      get LineRader() {\n        return LineRader;\n      },\n      get eventBus() {\n        return eventBus;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n};","map":{"version":3,"mappings":"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","names":["scene","camera","renderer","controls","createMesh","animate","gsap","axse","ref","onMounted","watch","Alarm","LineWall","FlyLineShader","LineRader","eventBus","sceneDiv","add","value","appendChild","domElement","meshDestroy","meshFn","火警","position","i","lineWall","meshIndex","push","mesh","治安","flyLineShader","电力","lineRader","on","forEach","item","visible","x","props","resCityList","y","z","to","target","duration","ease","onRemove","alarm","name","onClick","emit"],"sources":["D:/vscodeDemo/threeDemo/threejs_smartcity/src/components/SceneCanvas.vue"],"sourcesContent":["<template>\n  <div class=\"sceneCanvas\" ref=\"sceneDiv\">\n    <!-- 画布元素追加 -->\n  </div>\n</template>\n<!-- 场景 -->\n<script setup>\n// 1.导入threejs\n// import * as THREE from 'three'\n// 2.导入(初始化)场景\nimport scene from '@/threeModal/scene'\n// 3.1导入相机配置\nimport camera from '@/threeModal/camera'\n// 4.导入渲染器\nimport renderer from '@/threeModal/renderer'\n// // 导入控制器\nimport controls from '@/threeModal/controls'\n// 导入创建物体文件\nimport createMesh from '@/threeModal/createMesh'\n// 导入渲染更新\nimport animate from '@/threeModal/animate'\n// 导入初始化监听屏幕大小\nimport '@/threeModal/init'\nimport gsap from 'gsap'\n// 5.1导入坐标轴\nimport axse from '@/threeModal/axseHelp'\nimport { ref, onMounted, defineProps, watch } from 'vue'\n\nimport Alarm from '@/threeModal/mesh/alarm'\nimport LineWall from '@/threeModal/mesh/lineWall'\nimport FlyLineShader from '@/threeModal/mesh/flyLineShader'\nimport LineRader from '@/threeModal/mesh/lineRader'\n\nimport eventBus from '@/utils/eventBus'\nconst props = defineProps(['resCityList'])\n// 7.1获取场景div\nlet sceneDiv = ref(null)\n\n// 3.2.将相机添加进场景\nscene.add(camera)\n\n// 5.2 创建坐标轴\nscene.add(axse)\n\n// 6.创建物体\ncreateMesh()\n\n// vue挂载成功之后再去追加dom\nonMounted(() => {\n  // 7.2将渲染器加入dom\n  sceneDiv.value.appendChild(renderer.domElement)\n  // 8.2渲染执行\n  animate()\n})\nconst meshDestroy = []\nconst meshFn = {\n  火警: (position, i) => {\n    // 光墙\n    // 添加光墙\n    const lineWall = new LineWall(0.3, 2, position)\n    lineWall.meshIndex = i\n    meshDestroy.push(lineWall)\n    scene.add(lineWall.mesh)\n  },\n  治安: (position, i) => {\n    // 光线\n    // 添加光线\n    const flyLineShader = new FlyLineShader(position)\n    flyLineShader.meshIndex = i\n    scene.add(flyLineShader.mesh)\n    meshDestroy.push(flyLineShader)\n  },\n  电力: (position, i) => {\n    // 雷达\n    // 添加雷达\n  const lineRader = new LineRader(1, position)\n  lineRader.meshIndex = i\n  scene.add(lineRader.mesh)\n    meshDestroy.push(lineRader)\n  }\n}\neventBus.on('meitSelect', i => {\n  meshDestroy.forEach(item => {\n    if(item.meshIndex === i) {\n      item.mesh.visible = true\n    } else {\n      item.mesh.visible = false\n    }\n    \n  })\n  const position = {\n      x: props.resCityList[i].position.x / 15 -3.5,\n      y: 0,\n      z: props.resCityList[i].position.z / 15 - 3.5\n    }\n    gsap.to(controls.target, {\n      x: position.x,\n      y: position.y,\n      z: position.z,\n      duration: 1,\n      ease: 'none'\n    })\n})\nwatch(\n  () => props.resCityList,\n  () => {\n    // 每次得到新的数据要销毁旧物体\n    meshDestroy.forEach(item => {\n      item.onRemove()\n    })\n    props.resCityList.forEach((item, i) => {\n      // console.log(item, i)\n      //    返回的位置数据为0-100\n      const position = {\n        x: item.position.x / 15 - 3.5,\n        z: item.position.z / 15 - 3.5\n      }\n      // 生成精灵图\n      // 添加警告标识\n      const alarm = new Alarm(item.name, position)\n      alarm.meshIndex = i\n      alarm.onClick(() => {\n        // console.log(item.name, i);\n        eventBus.emit(\"spriteClick\", alarm);\n      });\n      // 将生成的物体放到数组，以待每次新数据传入生成新物体时销毁旧物体\n      meshDestroy.push(alarm)\n      scene.add(alarm.mesh)\n      if (meshFn[item.name]) {\n        meshFn[item.name](position, i)\n      }\n    })\n  }\n)\n</script>\n\n<style scoped lang=\"scss\">\n// 画布全屏\n.scene {\n  width: 100vw;\n  height: 100vh;\n  position: fixed;\n  left: 0;\n  top: 0;\n  z-index: 2;\n}\n</style>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}