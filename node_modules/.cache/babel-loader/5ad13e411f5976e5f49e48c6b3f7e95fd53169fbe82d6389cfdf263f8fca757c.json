{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';\nimport * as THREE from 'three';\nimport scene from '@/threeModal/scene';\nimport gsap from 'gsap';\n// import modityCityMaterial from '../modity/modityCityMaterial'\n// import FlyLine from './flyLine'\n// import FlyLineShader from './flyLineShader'\n// import CreateMeshLine from './createMeshLine'\n// import LineWall from './lineWall'\n// import LineRader from './lineRader'\n// import Alarm from './alarm'\nexport default class CreateCity {\n  constructor() {\n    let daoLoader = new DRACOLoader();\n    let loader = new GLTFLoader();\n    daoLoader.setDecoderPath('/glb/');\n    daoLoader.setDecoderConfig({\n      type: 'js'\n    });\n    daoLoader.preload();\n    loader.setDRACOLoader(daoLoader);\n    // 加载城市模型\n    loader.load('/glb/garden.glb', gltf => {\n      gltf.scene.traverse(item => {\n        console.log(item);\n        if (item.name === 'car') {\n          this.car = item;\n        }\n        // 根据点创建曲线\n\n        if (item.name === 'NURBS_曲线002') {\n          const points = [];\n          for (let i = item.geometry.attributes.position.count - 1; i >= 0; i--) {\n            points.push(new THREE.Vector3(item.geometry.attributes.position.getX(i)), new THREE.Vector3(item.geometry.attributes.position.getY(i)), new THREE.Vector3(item.geometry.attributes.position.getZ(i)));\n          }\n          this.curve = new THREE.CatmullRomCurve3(points);\n          // console.log(this.curve);\n          this.curveProgress = 0;\n          gsap.to(this.car, {\n            curveProgress: 0.999,\n            duration: 10,\n            repeat: -1,\n            onUpdate: () => {\n              const point = this.curve.getPoint(this.curveProgress);\n              this.car.position.set(point.x, point.y, point.z);\n              if (this.curveProgress + 0.001 < 1) {\n                const point = this.curve.getPoint(this.curveProgress + 0.001);\n                this.car.lookAt(point);\n              }\n              console.log(this.car);\n            }\n          });\n        }\n      });\n      scene.add(gltf.scene);\n    });\n\n    // 添加飞线\n    // const flyLine = new FlyLine()\n    // scene.add(flyLine.mesh)\n\n    // const flyLineShader = new FlyLineShader()\n    // scene.add(flyLineShader.mesh)\n\n    // // 添加光墙\n    // const lineWall = new LineWall()\n    // scene.add(lineWall.mesh)\n\n    // // 添加雷达\n    // const lineRader = new LineRader()\n    // scene.add(lineRader.mesh)\n\n    // // 添加警告标识\n    // const alarm = new Alarm()\n    // scene.add(alarm.mesh)\n    // alarm.onClick(() => {\n    //   alert('警告')\n    // })\n  }\n}","map":{"version":3,"names":["DRACOLoader","GLTFLoader","THREE","scene","gsap","CreateCity","constructor","daoLoader","loader","setDecoderPath","setDecoderConfig","type","preload","setDRACOLoader","load","gltf","traverse","item","console","log","name","car","points","i","geometry","attributes","position","count","push","Vector3","getX","getY","getZ","curve","CatmullRomCurve3","curveProgress","to","duration","repeat","onUpdate","point","getPoint","set","x","y","z","lookAt","add"],"sources":["D:/vscodeDemo/threeDemo/threejs_park/src/threeModal/mesh/createCity.js"],"sourcesContent":["import { DRACOLoader } from 'three/examples/jsm/loaders/DRACOLoader'\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport * as THREE from 'three'\r\nimport scene from '@/threeModal/scene'\r\nimport gsap from 'gsap'\r\n// import modityCityMaterial from '../modity/modityCityMaterial'\r\n// import FlyLine from './flyLine'\r\n// import FlyLineShader from './flyLineShader'\r\n// import CreateMeshLine from './createMeshLine'\r\n// import LineWall from './lineWall'\r\n// import LineRader from './lineRader'\r\n// import Alarm from './alarm'\r\nexport default class CreateCity {\r\n  constructor() {\r\n    let daoLoader = new DRACOLoader()\r\n    let loader = new GLTFLoader()\r\n    daoLoader.setDecoderPath('/glb/')\r\n    daoLoader.setDecoderConfig({type: 'js'})\r\n    daoLoader.preload()\r\n    loader.setDRACOLoader(daoLoader)\r\n    // 加载城市模型\r\n    loader.load('/glb/garden.glb', gltf => {\r\n      gltf.scene.traverse(item => {\r\n        console.log(item)\r\n        if(item.name === 'car'){\r\n          this.car = item\r\n        }\r\n        // 根据点创建曲线\r\n        \r\n        if(item.name === 'NURBS_曲线002') {\r\n          const points = []\r\n          for(let i = item.geometry.attributes.position.count - 1;i >= 0;i--) {\r\n            points.push(new THREE.Vector3(item.geometry.attributes.position.getX(i)), \r\n            new THREE.Vector3(item.geometry.attributes.position.getY(i)),\r\n            new THREE.Vector3(item.geometry.attributes.position.getZ(i)))\r\n          }\r\n          this.curve = new THREE.CatmullRomCurve3(points)\r\n          // console.log(this.curve);\r\n          this.curveProgress = 0\r\n          gsap.to(this.car, {\r\n            curveProgress: 0.999,\r\n            duration: 10,\r\n            repeat: -1,\r\n            onUpdate: () => {\r\n              const point = this.curve.getPoint(this.curveProgress)\r\n              this.car.position.set(point.x, point.y, point.z)\r\n              if (this.curveProgress + 0.001 < 1) {\r\n                const point = this.curve.getPoint(this.curveProgress + 0.001)\r\n                this.car.lookAt(point)\r\n              }\r\n              console.log(this.car);\r\n            }\r\n          })\r\n        }\r\n      })\r\n      scene.add(gltf.scene)\r\n    })\r\n  \r\n    // 添加飞线\r\n    // const flyLine = new FlyLine()\r\n    // scene.add(flyLine.mesh)\r\n  \r\n    // const flyLineShader = new FlyLineShader()\r\n    // scene.add(flyLineShader.mesh)\r\n  \r\n    // // 添加光墙\r\n    // const lineWall = new LineWall()\r\n    // scene.add(lineWall.mesh)\r\n  \r\n    // // 添加雷达\r\n    // const lineRader = new LineRader()\r\n    // scene.add(lineRader.mesh)\r\n  \r\n    // // 添加警告标识\r\n    // const alarm = new Alarm()\r\n    // scene.add(alarm.mesh)\r\n    // alarm.onClick(() => {\r\n    //   alert('警告')\r\n    // })\r\n  }\r\n\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}